<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
  <title>在线选座</title>
  <link rel="stylesheet" href="dist/weui.css" />
  <link rel="stylesheet" href="dist/self.css" />
  <link rel="stylesheet" href="font/iconfont.css" />
  <link rel="stylesheet" href="dist/jquery-weui.css" />
  <!-- 在线选座-->
  <link rel="stylesheet" href="dist/seat.css">
  <script src="dist/jquery.js"></script>
  <script type="text/javascript" src="dist/jquery.seat-charts.min.js"></script>
</head>

<body class="page-swipe">
  <div class="title">
    <div class="pull-left title-form"><a onclick="javascript:history.back(-1);"><i class="iconfont icon-shangyiyehoutuifanhui
"></i></a></div>
    <div class="pull-left text-center title-form">预定门票</div>
  </div>
  <div class="clearfix"></div>
  <!-- 演出基本信息 -->
  <div class="weui_cells detail-choose">
    <p class="detail-name">讲座《中华文化如何普及化》(数字讲座)</p>
    <div class="detail-active choose-form">时间：2017-10-1</div>
    <div class="detail-active choose-form">地点：钟祥文化宫</div>
    <div class="detail-active choose-form">电话：0000-0000000</div>
  </div>
  <!-- 场次选择 -->
  <div class="weui_cells weui_cells_form">
    <div class="weui_cell weui_cell_select">
      <div class="weui_cell_bd weui_cell_primary">
        <select class="weui_select" name="select1">
        <option selected="" value="0">选择场次</option>
        <option value="1">8:30-9:30</option>
        <option value="2">9:30-10:30</option>
        <option value="3">10:30-11:30</option>
      </select>
      </div>
    </div>
  </div>
  <!-- =====在线选座===== -->
  <div class="weui_cells">
    <div class="weui_cell">
      <a href="#" class="weui_btn weui_btn_mini weui_btn_primary btn-yuding" id="ticket">在线选座</a>
    </div>
  </div>
  <!-- 已选 -->
  <div class="weui_cells">
    <div class="weui_cell">
      已选：
      <ul id="selected-seats" class="selected-seats"></ul>
    </div>
  </div>
  <!-- 座次页面 -->
  <div class="demo full-width">
    <div class="left-seat full-width">
      <div id="seat-map" class="">
        <div class="front">屏幕</div>
      </div>
      <div id="legend"></div>
      <div class="clearfix"></div>
    </div>

    <div class="booking-details full-width">
      <p>影片：<span>星际穿越</span></p>
      <p>时间：<span>11月14日 21:00</span></p>
      <p>座位：</p>
      <ul id="selected-seats" class="selected-seats"></ul>
      <div class="clearfix"></div>
      <p>票数：<span id="counter">0</span></p>
      <p>总计：<b>￥<span id="total">0</span></b></p>
      <button class="checkout-button">预定门票</button>
    </div>
  </div>
  <!-- =====选座结束===== -->

  <!-- 手机号 -->
  <div class="weui_cells weui_cells_form">
    <div class="weui_cells_title">为了顺利取票，请输入您的手机号码</div>
    <div class="weui_cell">
      <div class="weui_cell_hd"><label class="weui_label">手机号</label></div>
      <div class="weui_cell_bd weui_cell_primary">
        <input class="weui_input" type="tel" placeholder="请输入手机号">
      </div>
    </div>
    <div class="weui_cell weui_vcode">
      <div class="weui_cell_hd"><label class="weui_label">验证码</label></div>
      <div class="weui_cell_bd weui_cell_primary">
        <input class="weui_input" type="number" placeholder="请输入验证码">
      </div>
      <div class="weui_cell_ft">
        <img src="img/vcode.jpg">
      </div>
    </div>
    <div class="weui_cell weui_cell_switch">
      <div class="weui_cell_hd weui_cell_primary">短信通知</div>
      <div class="weui_cell_ft">
        <input class="weui_switch" type="checkbox">
      </div>
    </div>
  </div>
  <!-- 购票须知 -->
  <div class="bordered">
    <h4 class="font-bold text-warning">预订须知</h4> 1. 全年未入场票数达10张，将被取消当年预订资格；<br> 2. 如需退票，请至“我的空间-活动管理“，退票截止至活动前一天（活动当天不可退票）；<br> 3. 如因不可控因素导致活动无法进行，举办方有权延期或取消活动，并以短信方式通知订票人；<br> 4. 如参加区图书馆、文化馆活动的市民，由于停车位有限，建议读者搭乘公共交通前往；<br> 5. 活动最终解释权归举办方所有。<br>
  </div>
  <div class="weui_cells font-size-8">
    <div class="weui_cell">
      <div class="checkbox">
        <label>
      <input type="checkbox"> <span class="text-warning">我已阅读并接受订票须知相关条款。</span>
    </label>
      </div>
    </div>
  </div>
  <a href="yd-success.html" class="weui_btn weui_btn_primary">预定门票</a>


  <div class="weui-row footer">
    <div class="weui-col-25 text-center border-right word-break">user-name</div>
    <div class="weui-col-25 text-center border-right">退出</div>
    <div class="weui-col-25 text-center border-right" onClick="location='feedback.html'">反馈</div>
    <div class="weui-col-25 text-center"><a href="javascript:scroll(0,0)">回到顶部</a></div>
    <div class="clearfix"></div>
    <div class="text-center full-width">Copyright &copy; 2017 钟祥文化云 版权所有</div>
  </div>
  <div class="weui_tabbar">
    <a href="javascript:;" class="weui_tabbar_item">
      <div class="weui_tabbar_icon">
        <i class="icon iconfont icon-home1"></i>
      </div>
      <p class="weui_tabbar_label">首页</p>
    </a>
    <a href="javascript:;" class="weui_tabbar_item">
      <div class="weui_tabbar_icon">
        <i class="icon iconfont icon-huodong"></i>
      </div>
      <p class="weui_tabbar_label">活动</p>
    </a>
    <a href="javascript:;" class="weui_tabbar_item">
      <div class="weui_tabbar_icon">
        <i class="icon iconfont icon-gushi1"></i>
      </div>
      <p class="weui_tabbar_label">故事</p>
    </a>
    <a href="javascript:;" class="weui_tabbar_item">
      <div class="weui_tabbar_icon">
        <i class="icon iconfont icon-wode"></i>
      </div>
      <p class="weui_tabbar_label">我的</p>
    </a>
  </div>

  <script src="dist/jquery-weui.js"></script>
  <script src="dist/swiper.min.js"></script>
  <script src="dist/city-picker.js"></script>

  <script src="dist/pull-to-refresh.js"></script>

  <script type="text/javascript">
    $("#ticket").click(function(event) {
      $(".demo").show();
    });
    $(".checkout-button").click(function(event) {
      $(".demo").hide();
    });
    var price = 0; //票价
    $(document).ready(function() {
      var $cart = $('.selected-seats'), //座位区
        $counter = $('#counter'), //票数
        $total = $('#total'); //总计金额

      var sc = $('#seat-map').seatCharts({
        map: [ //座位图
          'aaaaaaaaaa',
          'aaaaaaaaaa',
          '__________',
          'aaaaaaaa__',
          'aaaaaaaaaa',
          'aaaaaaaaaa',
          'aaaaaaaaaa',
          'aaaaaaaaaa',
          'aaaaaaaaaa',
          'aa__aa__aa'
        ],
        naming: {
          top: false,
          getLabel: function(character, row, column) {
            return column;
          }
        },
        legend: { //定义图例
          node: $('#legend'),
          items: [
            ['a', 'available', '可选座'],
            ['a', 'unavailable', '已售出']
          ]
        },
        click: function() { //点击事件
          if (this.status() == 'available') { //可选座
            $('<li>' + (this.settings.row + 1) + '排' + this.settings.label + '座</li>')
              .attr('id', 'cart-item-' + this.settings.id)
              .data('seatId', this.settings.id)
              .appendTo($cart);

            $counter.text(sc.find('selected').length + 1);
            $total.text(recalculateTotal(sc) + price);

            return 'selected';
          } else if (this.status() == 'selected') { //已选中
            //更新数量
            $counter.text(sc.find('selected').length - 1);
            //更新总计
            $total.text(recalculateTotal(sc) - price);

            //删除已预订座位
            $('#cart-item-' + this.settings.id).remove();
            //可选座
            return 'available';
          } else if (this.status() == 'unavailable') { //已售出
            return 'unavailable';
          } else {
            return this.style();
          }
        }
      });
      //已售出的座位
      sc.get(['1_2', '4_4', '4_5', '6_6', '6_7', '8_5', '8_6', '8_7', '8_8', '10_1', '10_2']).status('unavailable');

    });
    //计算总金额
    function recalculateTotal(sc) {
      var total = 0;
      sc.find('selected').each(function() {
        total += price;
      });

      return total;
    }
  </script>

</body>

</html>
